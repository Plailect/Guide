---
title: "Informazioni sull'OTP"
permalink: /otp-info.html
lang: it_IT
ref: otp-info
---

L'OTP è una regione, avente lunghezza 0x100 byte, piena di dati apparentemente casuali, collocata all'indirizzo di memoria 0x10012000. Si presume che le chiavi univoche per console siano derivate da questa regione, anche se è ancora sconosciuto esattamente come questo avvenga. Questa regione di memoria è, probabilmente, l'archivio dei dati univoci della console, che è decrittato dal bootrom, ma non potremo sapere precisamente come, finché qualcuno non effettuerà un dump completo del bootrom. Al 33c3 del 2016, è stato rivelato che è stato eseguito un dump completo del bootrom, ma tuttavia non è ancora stato rilasciato.

Prima della versione 3.0.0X, l'indirizzo di memoria 0x10012000 (ovvero l'OTP) era lasciata non protetta e poteva essere dumpata da un attaccante con sufficienti privilegi (esecuzione di codice sul processore arm9).

Dopo la versione 3.0.0-X, Nintendo ha optato per bloccare questa sezione con il registro CFG_SYSPROT9, il quale inoltre blocca il bootloader e viene impostato a pochi istanti dal boot, molto prima che si possa ottenere l'esecuzione arbitraria di codice. Questo registro può essere impostato solo una volta, e non può essere disattivato fino a quando l'unità non è del tutto spenta, di conseguenza è impossibile fare il dump di tutto l'OTP su una versione di firmware superiore a 3.0.0-X.

Esiste, tuttavia, un metodo per fare il dump dell'hash dell'OTP sulla versione 9.6.0-X. Dal momento che Kernel9Loader non pulisce il registro SHA_HASH dopo il suo utilizzo, tramite il dump di SHA_HASH otterremo l'hash dell'OTP che è stato trasferito da Kernel9Loader a Kernel9. Inoltre, c'è da tempo una falla dove un reboot del MCU causato dall'i2c non pulirà la RAM come dovrebbe.

This allows for a hardware based attack where arbitrary data is written to nand_sector96+0x10 in a SysNAND backup and flashed to the device. Afterwards we wire the i2c to MCU reboot on our command, write a payload (which will write 0x1000A040 - 0x1000A060 to a file on the SD card) to arm9 memory somewhere, fill all memory with a NOP sled followed by a JMP instruction pointing to the payload. We can then MCU reboot repeatedly (incrementing nand_sector96+0x10 by 1 each time) until the Kernel9Loader jumps to the payload by random chance.

Per via della complessità e dell'hardware aggiuntivo presenti nel metodo descritto sopra, ho deciso di limitare lo scopo di questa guida strettamente all'approccio software del downgrade ad una versione inferiore a 3.0.0-X. La versione 2.1.0-X è stata scelta perché è l'unica versione inferiore a 3.0.0-X che contiene una versione del browser totalmente sfruttabile (2.0.0-X ha un browser parzialmente sfruttabile, ma non funziona per altri motivi).

This process involves flashing your CTRNAND to 2.1.0-4. This is accomplished by installing a premade CTRNAND image containing 2.1.0, copying your console specific files (such as `moveable.sed` and `SecureInfo_A`) to it, then fixing the title database CMACS. Sul New 3DS inoltre scambia lo slot di criptazione della CTRNAND e installa un header NCSD dell'Old 3DS nella NAND, permettendo l'avvio del software 2.1.0 esclusivo dell'Old 3DS.