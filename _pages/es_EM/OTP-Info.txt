---
title: "Información de OTP"
permalink: /otp-info.html
lang: es_EM
ref: otp-info
---

El OTP es una región de datos 0x100 de datos aparentemente aleatorios en la dirección 0x10012000. Se presume que las claves únicas de la consola derivan de esta región, aunque se desconoce en la actualidad exactamente cómo. La región es probablemente el almacenamiento de datos únicos de la consola que es descifrada por el bootrom, pero no sabemos cómo eso es hecho hasta que alguien vuelque el bootrom (totalmente protegido). Hasta la fecha, se desconoce si alguien ha volcado con éxito el bootrom protegido.

Antes de la versión 3.0.0-X, la región 0x10012000 (OTP) estaba desprotegida y podía ser volcada por un atacante con suficientes permisos (ejecución de código arm9).

Después de la versión 3.0.0-X, Nintendo bloqueó esta región mediante el registro CFG_SYSPROT9, que también bloquea el gestor de arranque y se establece muy temprano en el inicio, mucho antes de ser capaces de obtener la ejecución de código. Este registro puede ser establecido exactamente una vez y no se puede cambiar hasta que la unidad esté completamente apagada, y por lo tanto es imposible hacer un volcado del OTP completo sin una versión por debajo de 3.0.0-X.

Sin embargo, hay un método para volcar el hash del OTP en la versión 9.6.0-X. A causa de que Kernel9Loader no borra el registro SHA_HASH tras ser utilizado, volcar SHA_HASH dará el hash del OTP que fue entregado a Kernel9 desde Kernel9Loader. Además, existe una vulnerabilidad prolongada donde un reinicio MCU causado por i2c no borra RAM como se supone.

Esto permito un ataque de hardware donde datos arbitrarios son escritos al nand_sector96+0x10 en una copia de seguridad de SysNAND y flasheada al dispositivo. Luego conectamos i2c al reinicio MCU en nuestro comando, escribir un payload (que escribirá 0x1000A040 - 0x1000A060 en un archivo en la tarjeta SD) en algún lugar de la memoria arm9, llenar toda la memoria con un NOP-sled seguido de una instrucción JMP apuntando al payload. Entonces podemos reiniciar MCU varias veces (incrementando el nand_sector96 + 0 x 10 por 1 cada vez) hasta que el Kernel9Loader salta al payload por azar.

Debido a la complejidad y el hardware adicional en el método descrito anteriormente, he decidido limitar el alcance de esta guía estrictamente a solo usar software para downgradear a una versión por debajo de 3.0.0-X. La versión 2.1.0-X fue seleccionada porque es la única versión por debajo de 3.0.0-X que contiene una versión de navegador totalmente vulnerable (2.0.0-X tiene un navegador parcialmente aprovechable, pero no funciona por otras razones).

Este proceso implica downgradear su CTRNAND a 2.1.0-4. Esto se logra mediante la instalación de una imagen CTRNAND prefabricada que contiene 2.1.0, copiar los archivos específicos de consola (como 'moveable.sed' y 'SecureInfo_A'), entonces arreglar la base de datos de título CMACS. En la New 3DS, también cambia de ranura de cifrado de CTRNAND e instala una cabecera NCSD de old 3DS en la NAND, lo que le permite arrancar el software 2.1.0 exclusivo de la Old 3DS.